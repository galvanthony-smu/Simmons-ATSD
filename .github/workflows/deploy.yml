name: Deploy static site to s2
on:
  push:
    branches: [ main ]
  workflow_dispatch: {}

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # Load your SSH private key + known_hosts
      - uses: shimataro/ssh-key-action@v2
        with:
          key: ${{ secrets.DEPLOY_KEY }}
          known_hosts: ${{ secrets.KNOWN_HOSTS }}

      # Make sure the target directory exists on s2
      - name: Ensure target dir exists
        run: ssh ${{ vars.DEPLOY_USER }}@${{ vars.DEPLOY_HOST }} "mkdir -p ${{ vars.DEPLOY_PATH }}"

      # Push the site/ folder to your web root
      - name: Upload via rsync
        run: rsync -az --delete site/ ${{ vars.DEPLOY_USER }}@${{ vars.DEPLOY_HOST }}:${{ vars.DEPLOY_PATH }}/
